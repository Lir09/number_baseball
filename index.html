<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대신 매점 - 온라인 쇼핑몰</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Noto Sans KR', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: #fafafa;
    color: #222;
    line-height: 1.6;
}

.header {
    background: #ffffff;
    border-bottom: 1px solid #eaeaea;
    padding: 1rem 0;
    box-shadow: none;
}

.container {
    max-width: 1140px;
    margin: 0 auto;
    padding: 0 24px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 24px;
    font-weight: 600;
    color: #111;
    text-decoration: none;
    letter-spacing: 0.04em;
}

.cart-icon {
    background: #f0f0f0;
    padding: 10px 16px;
    border-radius: 9999px;
    cursor: pointer;
    transition: background-color 0.25s ease;
    font-size: 1.2rem;
    color: #555;
}

.cart-icon:hover {
    background: #e0e0e0;
}

.main-content {
    padding: 3rem 0;
}

.section {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
    margin-bottom: 2.5rem;
    overflow: hidden;
}

.section-header {
    background: #f8f8f8;
    color: #333;
    padding: 1.25rem 2rem;
    font-size: 1.25rem;
    font-weight: 600;
    user-select: none;
    border-bottom: 1px solid #eaeaea;
}

.section-content {
    padding: 2rem;
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.8rem;
}

.product-card {
    border-radius: 12px;
    background: #fff;
    border: 1px solid #eee;
    cursor: pointer;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.product-card:hover {
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.08);
    transform: translateY(-4px);
}

.product-image {
    height: 180px;
    background: #f9f9f9;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: #bbb;
    user-select: none;
}

.product-info {
    padding: 1.2rem 1.5rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.4rem;
    color: #222;
}

.product-price {
    font-size: 1.2rem;
    font-weight: 700;
    color: #444;
    margin-bottom: 1rem;
}

.btn {
    background: linear-gradient(135deg, #757575 0%, #424242 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    width: 100%;
    transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
}

.btn:hover {
    background-color: #616161;
    transform: scale(1.03);
    box-shadow: 0 8px 15px rgba(97, 97, 97, 0.5);
}

.btn-secondary {
    background: #f5f5f5;
    color: #222;
}

.btn-secondary:hover {
    background: #ddd;
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #eee;
    font-size: 1.1rem;
    color: #444;
}

.cart-item:last-child {
    border-bottom: none;
}

.cart-total {
    background: #222;
    color: white;
    padding: 1.5rem 2rem;
    margin-top: 1.5rem;
    border-radius: 12px;
    text-align: center;
    font-size: 1.25rem;
    font-weight: 700;
}

.order-form {
    display: grid;
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-label {
    font-weight: 600;
    margin-bottom: 0.4rem;
    color: #333;
    font-size: 1rem;
}

.form-input {
    padding: 12px 16px;
    border: 1.5px solid #ddd;
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    color: #222;
}

.form-input::placeholder {
    color: #aaa;
}

.form-input:focus {
    outline: none;
    border-color: #222;
}

.payment-methods {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.payment-method {
    border: 1.5px solid #ddd;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.3s ease, background-color 0.3s ease;
    user-select: none;
    color: #333;
    background: #fafafa;
}

.payment-method:hover {
    border-color: #222;
    background: #f0f0f0;
}

.payment-method.selected {
    border-color: #222;
    background: #e8e8e8;
    font-weight: 600;
}

.upload-area {
    border: 2px dashed #bbb;
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    background: #fafafa;
    cursor: pointer;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    user-select: none;
    color: #888;
}

.upload-area:hover {
    background: #f0f0f0;
    border-color: #888;
}

.upload-area.dragover {
    background: #e1e1e1;
    border-color: #555;
}

.hidden {
    display: none;
}

.success-message {
    background: #2ecc71;
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 12px;
    text-align: center;
    margin-top: 1rem;
    font-weight: 600;
}

.bank-info {
    background: #f9f9f9;
    border-left: 4px solid #222;
    padding: 1rem 1.5rem;
    border-radius: 0 10px 10px 0;
    margin: 1.5rem 0;
    color: #555;
}

.preview-image {
    max-width: 200px;
    max-height: 200px;
    border-radius: 12px;
    margin-top: 1rem;
    object-fit: cover;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.05);
}

@media (max-width: 768px) {
    .products-grid {
        grid-template-columns: 1fr;
    }

    .payment-methods {
        grid-template-columns: 1fr;
    }

    .section-content {
        padding: 1.5rem 1.5rem;
    }
}




    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">🛒 대신 매점</a>
<div id="cart-icon" class="cart-icon" onclick="showCart()"> 🛍️ 장바구니 (<span id="cart-count">0</span>) </div>

            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- 상품 목록 섹션 -->
            <div id="products-section" class="section">
                <!-- 상품 설명 표시 영역 -->
<div id="product-detail" class="section hidden">
  <div class="section-header">
    상품 설명
  </div>
  <div class="section-content" id="product-description">
    <!-- 여기 상품 설명이 들어갑니다 -->
  </div>
  <button class="btn btn-secondary" onclick="hideProductDetail()" style="margin-top: 1rem;">
    닫기
  </button>
</div>
                <div class="section-header">
                    🔥 인기 상품
                </div>
                <div class="section-content">
                    <div class="products-grid" id="products-grid">
                        <!-- 상품들이 JavaScript로 동적 생성됩니다 -->
                    </div>
                </div>
            </div>

            <!-- 장바구니 섹션 -->
            <div id="cart-section" class="section hidden">
                <div class="section-header">
                    🛍️ 장바구니
                </div>
                <div class="section-content">
                    <div id="cart-items"></div>
                    <div id="cart-total" class="cart-total hidden">
                        총 합계: <span id="total-amount">0</span>원
                    </div>
                    <button class="btn btn-secondary" onclick="showOrderForm()" id="order-btn" style="margin-top: 1rem; display: none;">
                        주문하기
                    </button>
                    <button class="btn" onclick="showProducts()" style="margin-top: 1rem;">
                        쇼핑 계속하기
                    </button>
                </div>
            </div>

            <!-- 주문 폼 섹션 -->
            <div id="order-section" class="section hidden">
                <div class="section-header">
                    📝 주문 정보 입력
                </div>
                <div class="section-content">
                    <form class="order-form" id="order-form">
                        <div class="form-group">
                            <label class="form-label">이름</label>
                            <input type="text" class="form-input" id="customer-name" placeholder="주문자 이름을 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">전화번호</label>
                            <input type="tel" class="form-input" id="customer-phone" placeholder="010-1234-5678" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">x학년 x반</label>
                            <input type="text" class="form-input" id="customer-address" placeholder="상세 주소를 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">결제 방법 선택</label>
                            <div class="payment-methods">
                                <div class="payment-method" onclick="selectPayment('bank')">
                                    🏦<br>계좌이체
                                </div>
                                <div class="payment-method selected" onclick="selectPayment('bank')">
                                    🏦<br>계좌이체
                                </div>
                                <div class="payment-method" onclick="selectPayment('bank')">
                                    🏦<br>계좌이체
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn">주문 완료</button>
                    </form>
                </div>
            </div>

            <!-- 결제 확인 섹션 -->
            <div id="payment-section" class="section hidden">
                <div class="section-header">
                    💰 계좌이체 결제 확인
                </div>
                <div class="section-content">
                    <div class="bank-info">
                        <h3>입금 계좌 정보</h3>
                        <p><strong>은행:</strong> sc제일은행</p>
                        <p><strong>계좌번호:</strong> 123456-78-901234</p>
                        <p><strong>예금주:</strong> 김가빈</p>
                        <p><strong>입금 금액:</strong> <span id="payment-amount">0</span>원</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">입금자명</label>
                        <input type="text" class="form-input" id="depositor-name" placeholder="입금하신 분의 성함을 입력하세요" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">입금 확인 증빙서류 업로드</label>
                        <div class="upload-area" onclick="document.getElementById('receipt-upload').click()">
                            <p>📁 클릭하여 파일을 선택하거나 드래그하여 업로드하세요</p>
                            <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                                (JPG, PNG, PDF 파일만 업로드 가능)
                            </p>
                        </div>
                        <input type="file" id="receipt-upload" class="hidden" accept="image/*,.pdf" onchange="handleFileUpload(event)">
                        <div id="upload-preview"></div>
                    </div>
                    
                    <button class="btn" onclick="confirmPayment()">결제 확인 완료</button>
                    <button class="btn btn-secondary" onclick="showOrderForm()" style="margin-top: 1rem;">이전으로</button>
                </div>
            </div>

            <!-- 주문 완료 섹션 -->
            <div id="success-section" class="section hidden">
                <div class="section-header">
                    ✅ 주문 완료
                </div>
                <div class="section-content">
                    <div class="success-message">
                        <h2>🎉 주문이 성공적으로 완료되었습니다!</h2>
                        <p>주문번호: <strong id="order-number"></strong></p>
                        <p>결제 확인 후 배송을 시작합니다.</p>
                        <p>빠른 시일 내에 연락드리겠습니다.</p>
                    </div>
                    <button class="btn" onclick="resetOrder()" style="margin-top: 2rem;">새로운 주문하기</button>
                </div>
            </div>
        </div>
    </main>

    <script>// 전역 변수



let cart = [];
let selectedPayment = 'bank';
let orderData = {};

// 상품 데이터
const products = [
    { id: 1, name: "예시 1", price: 899000, emoji: "📱" },
    { id: 2, name: "예시 2", price: 329000, emoji: "🎧" },
    { id: 3, name: "예시 3", price: 1299000, emoji: "💻" },
    { id: 4, name: "예시 4", price: 129000, emoji: "👟" },
    { id: 5, name: "예시 5", price: 89000, emoji: "🔊" },
    { id: 6, name: "예시 6", price: 45000, emoji: "🔌" },
    { id: 7, name: "예시 7", price: 299000, emoji: "⌚" },
    { id: 8, name: "예시 8", price: 159000, emoji: "⌨️" }
];

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    displayProducts();
    setupDragAndDrop();
    updateCartDisplay();
    selectPayment('bank');
});

// 상품 목록 표시
function displayProducts() {
    const grid = document.getElementById('products-grid');
    grid.innerHTML = '';
    
    products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
            <div class="product-image">${product.emoji}</div>
            <div class="product-info">
                <div class="product-name">${product.name}</div>
                <div class="product-price">${product.price.toLocaleString()}원</div>
                <button class="btn" onclick="addToCart(${product.id}, event)">장바구니 담기</button>
                <button class="btn btn-info" onclick="showProductDescription(${product.id})" style="margin-top: 0.5rem;">상품 설명</button>
            </div>
        `;
        grid.appendChild(productCard);
    });
}

// 상품 설명 팝업
function showProductDescription(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;

    alert(`${product.name} 설명:\n\n이 상품은 매우 훌륭한 제품입니다!\n가격: ${product.price.toLocaleString()}원`);
}

// "담기 완료" 알림 토스트 표시
function showToast(message) {
    let toast = document.createElement('div');
    toast.textContent = message;
    toast.style.position = 'fixed';
    toast.style.bottom = '80px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.background = 'rgba(0,0,0,0.8)';
    toast.style.color = 'white';
    toast.style.padding = '10px 20px';
    toast.style.borderRadius = '20px';
    toast.style.fontSize = '1rem';
    toast.style.zIndex = 2000;
    toast.style.opacity = '0';
    toast.style.transition = 'opacity 0.3s ease';

    document.body.appendChild(toast);

    // 서서히 나타나기
    requestAnimationFrame(() => {
        toast.style.opacity = '1';
    });

    // 1.5초 후 서서히 사라지고 제거
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.addEventListener('transitionend', () => {
            toast.remove();
        });
    }, 1500);
}

// 상품 이모지 복사해서 장바구니로 날아가는 애니메이션
function animateToCart(button, emoji) {
    const btnRect = button.getBoundingClientRect();
    const cartIcon = document.getElementById('cart-icon');
    if (!cartIcon) return;  // 아이콘 없으면 그냥 종료
    const cartRect = cartIcon.getBoundingClientRect();

    const flyingEmoji = document.createElement('div');
    flyingEmoji.textContent = emoji;
    flyingEmoji.style.position = 'fixed';
    flyingEmoji.style.left = btnRect.left + 'px';
    flyingEmoji.style.top = btnRect.top + 'px';
    flyingEmoji.style.fontSize = '2.5rem';
    flyingEmoji.style.pointerEvents = 'none';
    flyingEmoji.style.zIndex = 1000;
    flyingEmoji.style.transition = 'all 0.8s ease-in-out';
    flyingEmoji.style.userSelect = 'none';

    document.body.appendChild(flyingEmoji);

    requestAnimationFrame(() => {
        flyingEmoji.style.left = (cartRect.left + cartRect.width / 2) + 'px';
        flyingEmoji.style.top = (cartRect.top + cartRect.height / 2) + 'px';
        flyingEmoji.style.transform = 'scale(0.3)';
        flyingEmoji.style.opacity = '0.5';
    });

    flyingEmoji.addEventListener('transitionend', () => {
        flyingEmoji.remove();
        updateCartDisplay();
    });
}

// 장바구니에 상품 추가 (애니메이션 + 토스트 포함)
function addToCart(productId, event) {
    const product = products.find(p => p.id === productId);
    const existingItem = cart.find(item => item.id === productId);

    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ ...product, quantity: 1 });
    }

    // "담기 완료" 토스트 알림 띄우기
    showToast('✅ 담기 완료');

    // 상품 이모지 애니메이션 실행
    animateToCart(event.target, product.emoji);
}

// 장바구니 UI 업데이트
function updateCartDisplay() {
    const cartCount = document.getElementById('cart-count');
    const cartItems = document.getElementById('cart-items');
    const cartTotal = document.getElementById('cart-total');
    const orderBtn = document.getElementById('order-btn');
    
    const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = totalQuantity;
    
    if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">장바구니가 비어있습니다.</p>';
        cartTotal.classList.add('hidden');
        orderBtn.style.display = 'none';
        return;
    }
    
    cartItems.innerHTML = '';
    let total = 0;
    
    cart.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'cart-item';
        itemElement.innerHTML = `
            <div>
                <strong>${item.name}</strong><br>
                <span style="color: #666;">${item.price.toLocaleString()}원 × ${item.quantity}개</span>
            </div>
            <div>
                <button onclick="changeQuantity(${item.id}, -1)" style="background: #ddd; border: none; padding: 5px 10px; margin-right: 10px; border-radius: 5px;">-</button>
                <button onclick="changeQuantity(${item.id}, 1)" style="background: #74b9ff; color: white; border: none; padding: 5px 10px; margin-right: 10px; border-radius: 5px;">+</button>
                <button onclick="removeFromCart(${item.id})" style="background: #fd79a8; color: white; border: none; padding: 5px 10px; border-radius: 5px;">삭제</button>
            </div>
        `;
        cartItems.appendChild(itemElement);
        total += item.price * item.quantity;
    });
    
    document.getElementById('total-amount').textContent = total.toLocaleString();
    cartTotal.classList.remove('hidden');
    orderBtn.style.display = 'block';
}

// 수량 변경
function changeQuantity(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            removeFromCart(productId);
        } else {
            updateCartDisplay();
        }
    }
}

// 장바구니에서 상품 제거
function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateCartDisplay();
}

// 섹션 표시/숨김 관리
function showSection(sectionId) {
    const sections = ['products-section', 'cart-section', 'order-section', 'payment-section', 'success-section'];
    sections.forEach(id => document.getElementById(id).classList.add('hidden'));
    document.getElementById(sectionId).classList.remove('hidden');
}

// 화면 전환 함수들
function showProducts() {
    showSection('products-section');
}

function showCart() {
    showSection('cart-section');
}

function showOrderForm() {
    if (cart.length === 0) {
        alert('장바구니가 비어있습니다.');
        return;
    }
    showSection('order-section');
}

// 결제 방법 선택
function selectPayment(method) {
    selectedPayment = method;
    document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
    const btns = document.querySelectorAll(`.payment-method`);
    btns.forEach(btn => {
        if(btn.dataset.method === method) btn.classList.add('selected');
    });
}

// 파일을 Base64로 변환하는 함수 (Promise 반환)
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]); // base64만 반환
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// 주문 폼 제출 (async/await)
document.getElementById('order-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const depositorName = document.getElementById('depositor-name').value.trim();
    const receiptFile = document.getElementById('receipt-upload').files[0];

    let base64File = null;
    let fileName = '';
    let fileType = '';

    if (receiptFile) {
        base64File = await fileToBase64(receiptFile);
        fileName = receiptFile.name;
        fileType = receiptFile.type;
    }

    orderData = {
        name: document.getElementById('customer-name').value.trim(),
        phone: document.getElementById('customer-phone').value.trim(),
        address: document.getElementById('customer-address').value.trim(),
        payment: selectedPayment,
        items: [...cart],
        total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
        depositorName: depositorName || '',
        receiptFile: {
            name: fileName,
            type: fileType,
            data: base64File
        }
    };

    if (!orderData.name || !orderData.phone || !orderData.address) {
        alert('이름, 전화번호, 주소를 모두 입력해주세요.');
        return;
    }

    if (selectedPayment === 'bank') {
        document.getElementById('payment-amount').textContent = orderData.total.toLocaleString();
        showSection('payment-section');
    } else {
        completeOrder();
    }
});

// 파일 업로드 미리보기 및 처리
function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const preview = document.getElementById('upload-preview');
    preview.innerHTML = '';
    
    if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.style.maxWidth = '100px';
        img.style.maxHeight = '100px';
        preview.appendChild(img);
    } else {
        preview.textContent = `${file.name} 업로드 완료`;
    }
}

// 드래그 앤 드롭 영역 초기화 및 이벤트
function setupDragAndDrop() {
    const dropArea = document.getElementById('receipt-drop-area');
    const fileInput = document.getElementById('receipt-upload');

    dropArea.addEventListener('dragover', e => {
        e.preventDefault();
        dropArea.style.borderColor = '#0984e3';
        dropArea.style.backgroundColor = '#dfe6e9';
    });

    dropArea.addEventListener('dragleave', e => {
        e.preventDefault();
        dropArea.style.borderColor = '#ccc';
        dropArea.style.backgroundColor = '';
    });

    dropArea.addEventListener('drop', e => {
        e.preventDefault();
        dropArea.style.borderColor = '#ccc';
        dropArea.style.backgroundColor = '';
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            handleFileUpload({ target: fileInput });
        }
    });

    fileInput.addEventListener('change', handleFileUpload);
}

function addToCart(productId, event) {
    const product = products.find(p => p.id === productId);
    const existingItem = cart.find(item => item.id === productId);

    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ ...product, quantity: 1 });
    }

    // "담기 완료" 토스트 알림 띄우기
    showToast('✅ 담기 완료');

    // 상품 이모지 애니메이션 실행
    animateToCart(event.target, product.emoji);
}


// 결제 완료 처리
function completeOrder() {
    // 서버에 주문 데이터 전송 부분은 생략 (실제 서비스에서 구현)
    cart = [];
    updateCartDisplay();
    showSection('success-section');
}

// 주문 성공 후 다시 쇼핑으로
function continueShopping() {
    showProducts();
}

// 초기 장바구니 수량, 섹션 상태 등 유지 관리는 위 함수들이 담당

    </script>
</body>
</html>
